id: render-cli-backend-selection
title: Add CLI backend selection to avs-player
status: DONE
labels: [rendering, cli, user-facing]
depends_on:
  - render-rendercontext-integration
goal: >
  Add command-line options to avs-player allowing users to select rendering backend
  (CPU, OpenGL, File export). Makes framebuffer abstraction user-accessible.

completed_steps:
  - ✅ Added --render-backend CLI option (cpu, opengl, file).
  - ✅ Added --export-path CLI option for file backend.
  - ✅ Added --export-pattern CLI option (parsed, ready for future use).
  - ✅ Implemented backend routing to appropriate rendering modes.
  - ✅ Added comprehensive validation for incompatible option combinations.
  - ✅ Updated help text with backend documentation and examples.
  - ✅ Created detailed documentation with video export workflow examples.
  - ✅ Tested all three backends via CLI invocation.
  - ✅ Maintained backward compatibility with --headless flag.

acceptance_criteria:
  - ✅ avs-player --render-backend cpu runs headless (no window).
  - ✅ avs-player --render-backend opengl runs windowed (current behavior, default).
  - ✅ avs-player --render-backend file --export-path=./frames exports PNG sequence.
  - ✅ Invalid combinations produce clear error messages.
  - ✅ Documentation includes examples of each backend usage.
  - ✅ All existing CLI tests continue to pass (backward compatible).

test_hook:
  - "Manual: avs-player --render-backend=cpu --preset=test.avs runs without GPU."
  - "Manual: avs-player --render-backend=file --export-path=./out exports frames."
  - "ctest: CLI option parsing tests validate backend selection."

estimated_time: 1-2 hours

files_completed:
  - apps/avs-player/main.cpp
  - docs/JOB_22B_CLI_BACKENDS.md

files_not_modified:
  - apps/avs-player/README.md (not needed - help text in binary is sufficient)
  - libs/avs-compat/include/avs/compat/engine.hpp (not needed for CLI routing)
  - libs/avs-compat/src/engine.cpp (not needed for CLI routing)

priority: MEDIUM
blockers: []
notes: >
  Backend selection implemented at CLI level by routing to existing rendering paths.
  The three backends (cpu, opengl, file) route to appropriate modes:
  - cpu/file: Use runHeadless() with avs::Engine
  - opengl: Use existing windowed rendering (default)

  Future work (Job 22c) can update avs::Engine to use IFramebuffer internally,
  but this is not required for user-facing backend selection.
