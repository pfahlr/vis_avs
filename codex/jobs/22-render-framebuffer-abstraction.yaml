id: render-framebuffer-abstraction
title: Abstract framebuffer output for multiple rendering backends
status: DONE
labels: [rendering, architecture, vulkan]
depends_on:
  - render-multithreaded-effects
goal: >
  Decouple rendering from OpenGL to support multiple backends (OpenGL, Vulkan, CPU framebuffer, headless).
  Enables video encoding, image export, and future Vulkan migration for enhanced graphics.

  NOTE: This job has been completed and broken down into sub-jobs for remaining work:
  - Job 22a: RenderContext integration (critical path)
  - Job 22b: CLI backend selection (user-facing)
  - Job 22c: Effect migration (incremental)

completed_steps:
  - ✅ Define IFramebuffer interface in avs-core (width, height, pixel data access, present).
  - ✅ Implement OpenGLFramebuffer (FBO-based, GPU-accelerated).
  - ✅ Implement CPUFramebuffer (in-memory RGBA buffer, no GPU required).
  - ✅ Implement FileFramebuffer (writes frames to PNG sequence).
  - ✅ CMake integration for all backends.
  - ✅ Comprehensive test suite (15 tests, all passing).
  - ✅ Document framebuffer interface.

remaining_work:
  - See Job 22a: Update RenderContext to use IFramebuffer abstraction.
  - See Job 22b: Add --render-backend CLI option to avs-player.
  - See Job 22c: Update effects to use framebuffer abstraction.

acceptance_criteria:
  - ✅ CPU, OpenGL, and File backends implemented.
  - ✅ Headless rendering (CPU backend) produces correct output.
  - ✅ File backend exports frame sequences correctly.
  - ✅ Performance impact <5% for abstraction overhead.
  - ✅ Future Vulkan backend can be implemented without touching backend code.
  - ✅ All backend tests execute via ctest and pass (15/15 passing).
  - ⏳ Effects use framebuffer abstraction (Job 22a/22c).
  - ⏳ CLI backend selection available (Job 22b).

test_hook:
  - "ctest: framebuffer_backend_tests validates all backends (15 tests passing)."

files_completed:
  - libs/avs-core/include/avs/core/IFramebuffer.hpp
  - libs/avs-core/src/CPUFramebuffer.cpp
  - libs/avs-core/src/OpenGLFramebuffer.cpp
  - libs/avs-core/src/FileFramebuffer.cpp
  - libs/avs-core/src/stb_image_write_impl.cpp
  - libs/avs-core/CMakeLists.txt
  - tests/framebuffer/test_framebuffer_backends.cpp
  - tests/CMakeLists.txt
  - docs/JOB_22_FRAMEBUFFER_PROGRESS.md
