# Beat Gating Effect

The beat gating helper manages ONBEAT/5050/STICK style logic while exposing the
resulting state to downstream effects through `RenderContext::gating`. The gate
runs once per frame, consuming audio beat hints and the deterministic frame RNG
so that random toggles remain reproducible when `VIS_AVS_SEED` is specified.

## Parameters

| Name | Type | Description |
| ---- | ---- | ----------- |
| `onbeat` | bool | When true the gate activates only when a beat is detected. |
| `stick` | bool | Latches the gate after activation so it stays open until a later beat clears it. |
| `random_pos` | bool | Generates a new random offset (−1…1) for transforms whenever the gate opens. |
| `fifty_fifty` | bool | Applies a 50/50 coin flip on each beat to decide whether to open the gate. |
| `only_sticky` | bool | Ignores non-sticky beats, mirroring the legacy “ONLYSTICKY” mode. |
| `log_height` | int | Height in pixels of the diagnostic timeline. Set to 0 to disable drawing. |

## Output State

`RenderContext::gating` is populated with:

- `active`: whether the downstream effects should run this frame.
- `triggered`: true only on frames where the gate transitions because of a beat.
- `latched`: indicates a sticky latch is currently holding the gate open.
- `randomOffsetX/Y`: random offsets generated by the `random_pos` option.
- `flag`: a colour-coded status (0 inactive, 1 active, 2 triggered, 3 rejected beat, 4 latched).

The effect also paints a scrolling timeline across the top of the framebuffer
using the flag colours: red for inactive, green for active, yellow for newly
triggered, blue for beats ignored by `only_sticky`, and purple for latched
stickiness.
